<%= div_for article do %>
    <% if current_user? %>
        <div class="dark strip">
          <%= link_to 'Cerrar sesión', logout_path(:p => request.url), :class => 'logout',
                      :confirm => '¿Segurx que quieres cerrar tu sesión?' %>
          <%= button_group do %>
              <%= edit_button_link_to 'Editar', edit_article_path(article) if can? :edit, article %>
              <%= calendar_button_link_to 'Añadir imágen', new_mediafile_path(:p => article.id) if can? :new, Mediafile %>
              <%= fork_button_link_to 'Relacionar con...', new_article_relation_path(article) if can? :manage, article %>
              <%= danger_remove_button_link_to 'Borrar', article, :confirm => "ESTO NO SE PUEDE DESHACER. TAMBIEN SE BORRARÁN TODAS LAS RELACIONES CON ESTE ARTÍCULO. ¿Seguro que quieres borrar '#{article.title}' ?",
                                               :method => :delete if can? :manage, article %>
          <% end %>
          <ul class="properties">
            <li><label>Por:</label><%= article.author.name %></li>
            <li><label>Tipo:</label><%= t("article.categories.singular.#{article.category}") %></li>
            <li><label>Imágenes asociadas:</label>
              <% article.mediafiles.each do |mediafile| %>
                  <%= link_to "!!@#{mediafile.id}", mediafile %>&nbsp;|&nbsp;
              <% end %>
            </li>
            <li>
              <label>Relacionar con:</label>
              <% Article::CATEGORIES.each do |category| %>
                  <% singular = t("article.categories.singular.#{category}") %>
                  <%= link_to "&rarr; #{singular}".html_safe, new_article_relation_path(article, :c => category) %>
              <% end %>
            </li>
            <li><label>Relaciones:</label><%= link_to 'mostrar', article_relations_path(article) %></li>
          </ul>

        </div>
    <% else %>
        <div class="content">
          <%= link_to '&larr; Todos los art&iacute;culos'.html_safe, articles_path %>
        </div>
    <% end %>

    <div class="content">
      <ul>
        <% article.parents.each do |parent| %>
            <li><%= link_to parent.title, parent %></li>
        <% end %>
      </ul>

      <%= title article.title %>
    </div>


    <div class="render">
      <%= render_body article %>
    </div>



    <div class="content categorized">
      <% article.grouped_relations.each do |category, values| %>
          <% if values.length > 0 %>
              <h3><%= t("article.categories.prural.#{category}") %> relacionados: </h3>
              <%= render values %>
          <% end %>
      <% end %>
      <h2>Todas las relaciones:</h2>
      <% article.all_relations.each do |relation| %>
          <li>
            From: <%= link_to relation.from.title, relation.from %> (<%= relation.from.category %>)
            &lArr;&rArr;
            To: <%= link_to relation.to.title, relation.to %> (<%= relation.to.category %>)
          </li>
      <% end %>
      </ul>
    </div>

    <div class="content comment_area">
      <h3>Comentarios</h3>
      <%= render :partial => 'comments/form', :locals => {:resource => article, :comment => comment} %>
      <div class="comments">
        <% article.comments.each do |comment| %>
            <div class="nested_comments">
              <%= nested_comments comment.subtree.arrange(:order => :created_at) %>
            </div>
        <% end %>
      </div>
    </div>
<% end %>


